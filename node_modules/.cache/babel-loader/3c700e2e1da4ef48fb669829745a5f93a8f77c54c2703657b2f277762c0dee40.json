{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from\"react\";import{supabase}from\"../lib/supabaseClient.js\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthCtx=/*#__PURE__*/createContext(null);export const useAuth=()=>useContext(AuthCtx);export function AuthProvider(_ref){let{children}=_ref;const[session,setSession]=useState(null);const[role,setRole]=useState(\"guest\");// 'guest' | 'user' | 'admin'\nconst[loading,setLoading]=useState(true);async function fetchRole(userId){if(!userId){setRole(\"guest\");return;}const{data,error}=await supabase.from(\"profiles\").select(\"role\").eq(\"user_id\",userId).single();if(error){// fallback aman: kalau profil belum ada, anggap 'user'\nsetRole(\"user\");return;}setRole((data===null||data===void 0?void 0:data.role)||\"user\");}useEffect(()=>{let mounted=true;(async _session$user=>{const{data:{session}}=await supabase.auth.getSession();if(!mounted)return;setSession(session);await fetchRole(session===null||session===void 0?void 0:(_session$user=session.user)===null||_session$user===void 0?void 0:_session$user.id);setLoading(false);})();const{data:sub}=supabase.auth.onAuthStateChange((_event,sess)=>{var _sess$user;setSession(sess);fetchRole(sess===null||sess===void 0?void 0:(_sess$user=sess.user)===null||_sess$user===void 0?void 0:_sess$user.id);});return()=>{var _sub$subscription,_sub$subscription$uns;mounted=false;sub===null||sub===void 0?void 0:(_sub$subscription=sub.subscription)===null||_sub$subscription===void 0?void 0:(_sub$subscription$uns=_sub$subscription.unsubscribe)===null||_sub$subscription$uns===void 0?void 0:_sub$subscription$uns.call(_sub$subscription);};},[]);return/*#__PURE__*/_jsx(AuthCtx.Provider,{value:{session,role,loading},children:children});}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","supabase","jsx","_jsx","AuthCtx","useAuth","AuthProvider","_ref","children","session","setSession","role","setRole","loading","setLoading","fetchRole","userId","data","error","from","select","eq","single","mounted","_session$user","auth","getSession","user","id","sub","onAuthStateChange","_event","sess","_sess$user","_sub$subscription","_sub$subscription$uns","subscription","unsubscribe","call","Provider","value"],"sources":["C:/Projects/cidika-travel/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\nconst AuthCtx = createContext(null);\r\nexport const useAuth = () => useContext(AuthCtx);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [session, setSession] = useState(null);\r\n  const [role, setRole] = useState(\"guest\"); // 'guest' | 'user' | 'admin'\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  async function fetchRole(userId) {\r\n    if (!userId) { setRole(\"guest\"); return; }\r\n    const { data, error } = await supabase\r\n      .from(\"profiles\")\r\n      .select(\"role\")\r\n      .eq(\"user_id\", userId)\r\n      .single();\r\n    if (error) {\r\n      // fallback aman: kalau profil belum ada, anggap 'user'\r\n      setRole(\"user\");\r\n      return;\r\n    }\r\n    setRole(data?.role || \"user\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    (async () => {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      if (!mounted) return;\r\n      setSession(session);\r\n      await fetchRole(session?.user?.id);\r\n      setLoading(false);\r\n    })();\r\n\r\n    const { data: sub } = supabase.auth.onAuthStateChange((_event, sess) => {\r\n      setSession(sess);\r\n      fetchRole(sess?.user?.id);\r\n    });\r\n\r\n    return () => { mounted = false; sub?.subscription?.unsubscribe?.(); };\r\n  }, []);\r\n\r\n  return (\r\n    <AuthCtx.Provider value={{ session, role, loading }}>\r\n      {children}\r\n    </AuthCtx.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}