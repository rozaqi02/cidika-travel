{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/usePackages.js\nimport { useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { supabase } from \"../lib/supabaseClient.js\";\nexport default function usePackages({\n  live = true\n} = {}) {\n  _s();\n  const {\n    i18n\n  } = useTranslation();\n  const lang = (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0];\n  const [rows, setRows] = useState([]);\n  const [loading, setLoad] = useState(true);\n  const [error, setError] = useState(null);\n  const fetchData = async () => {\n    setLoad(true);\n    setError(null);\n    const {\n      data,\n      error\n    } = await supabase.from(\"packages\").select(`\n        id, slug, is_active, default_image, created_at,\n        price_tiers ( pax, price_idr, audience ),\n        package_locales ( lang, title, summary, spots, itinerary, include, note )\n      `).eq(\"is_active\", true).order(\"created_at\", {\n      ascending: true\n    });\n    if (error) {\n      setError(error);\n      setRows([]);\n      setLoad(false);\n      return;\n    }\n    const mapped = (data || []).map(p => {\n      // Pilih locale sesuai bahasa UI\n      const loc = Array.isArray(p.package_locales) && p.package_locales.find(l => l.lang === lang) || Array.isArray(p.package_locales) && p.package_locales.find(l => l.lang === \"en\") || Array.isArray(p.package_locales) && p.package_locales[0] || null;\n\n      // >>> TIDAK mem-filter audience. Bawa semua tier & normalisasi tipe.\n      const tiers = Array.isArray(p.price_tiers) ? p.price_tiers.map(t => ({\n        pax: Number(t.pax),\n        price_idr: Number(t.price_idr),\n        audience: String(t.audience || \"domestic\")\n      })) : [];\n      return {\n        id: p.id,\n        slug: p.slug,\n        default_image: p.default_image,\n        locale: loc,\n        price_tiers: tiers\n      };\n    });\n    setRows(mapped);\n    setLoad(false);\n  };\n  useEffect(() => {\n    fetchData();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [lang]);\n  useEffect(() => {\n    if (!live) return;\n    const ch = supabase.channel(\"packages-live\").on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"packages\"\n    }, fetchData).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"price_tiers\"\n    }, fetchData).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"package_locales\"\n    }, fetchData).subscribe();\n    return () => supabase.removeChannel(ch);\n  }, [live]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return {\n    rows,\n    loading,\n    error,\n    refetch: fetchData\n  };\n}\n_s(usePackages, \"y16zD3EZkdsx4780MNCMgBPB18s=\", false, function () {\n  return [useTranslation];\n});","map":{"version":3,"names":["useEffect","useState","useTranslation","supabase","usePackages","live","_s","i18n","lang","resolvedLanguage","language","split","rows","setRows","loading","setLoad","error","setError","fetchData","data","from","select","eq","order","ascending","mapped","map","p","loc","Array","isArray","package_locales","find","l","tiers","price_tiers","t","pax","Number","price_idr","audience","String","id","slug","default_image","locale","ch","channel","on","event","schema","table","subscribe","removeChannel","refetch"],"sources":["C:/projects/cidika-travel/src/hooks/usePackages.js"],"sourcesContent":["// src/hooks/usePackages.js\r\nimport { useEffect, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\nexport default function usePackages({ live = true } = {}) {\r\n  const { i18n } = useTranslation();\r\n  const lang = (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0];\r\n\r\n  const [rows, setRows] = useState([]);\r\n  const [loading, setLoad] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const fetchData = async () => {\r\n    setLoad(true);\r\n    setError(null);\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"packages\")\r\n      .select(`\r\n        id, slug, is_active, default_image, created_at,\r\n        price_tiers ( pax, price_idr, audience ),\r\n        package_locales ( lang, title, summary, spots, itinerary, include, note )\r\n      `)\r\n      .eq(\"is_active\", true)\r\n      .order(\"created_at\", { ascending: true });\r\n\r\n    if (error) {\r\n      setError(error);\r\n      setRows([]);\r\n      setLoad(false);\r\n      return;\r\n    }\r\n\r\n    const mapped = (data || []).map((p) => {\r\n      // Pilih locale sesuai bahasa UI\r\n      const loc =\r\n        (Array.isArray(p.package_locales) && p.package_locales.find((l) => l.lang === lang)) ||\r\n        (Array.isArray(p.package_locales) && p.package_locales.find((l) => l.lang === \"en\")) ||\r\n        (Array.isArray(p.package_locales) && p.package_locales[0]) ||\r\n        null;\r\n\r\n      // >>> TIDAK mem-filter audience. Bawa semua tier & normalisasi tipe.\r\n      const tiers = Array.isArray(p.price_tiers)\r\n        ? p.price_tiers.map((t) => ({\r\n            pax: Number(t.pax),\r\n            price_idr: Number(t.price_idr),\r\n            audience: String(t.audience || \"domestic\"),\r\n          }))\r\n        : [];\r\n\r\n      return {\r\n        id: p.id,\r\n        slug: p.slug,\r\n        default_image: p.default_image,\r\n        locale: loc,\r\n        price_tiers: tiers,\r\n      };\r\n    });\r\n\r\n    setRows(mapped);\r\n    setLoad(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (!live) return;\r\n    const ch = supabase\r\n      .channel(\"packages-live\")\r\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"packages\" }, fetchData)\r\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"price_tiers\" }, fetchData)\r\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"package_locales\" }, fetchData)\r\n      .subscribe();\r\n    return () => supabase.removeChannel(ch);\r\n  }, [live]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return { rows, loading, error, refetch: fetchData };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}