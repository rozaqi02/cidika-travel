{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projects\\\\cidika-travel\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabaseClient.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthCtx = /*#__PURE__*/createContext(null);\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthCtx);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const [session, setSession] = useState(null);\n  const [role, setRole] = useState(\"guest\");\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    let mounted = true;\n    async function load() {\n      var _session$user;\n      const {\n        data: {\n          session\n        }\n      } = await supabase.auth.getSession();\n      if (!mounted) return;\n      setSession(session);\n      if (session !== null && session !== void 0 && (_session$user = session.user) !== null && _session$user !== void 0 && _session$user.id) {\n        const {\n          data: prof\n        } = await supabase.from(\"profiles\").select(\"role\").eq(\"user_id\", session.user.id).single();\n        setRole((prof === null || prof === void 0 ? void 0 : prof.role) || \"user\");\n      } else {\n        setRole(\"guest\");\n      }\n      setLoading(false);\n    }\n    load();\n    const {\n      data: sub\n    } = supabase.auth.onAuthStateChange((_event, sess) => {\n      var _sess$user;\n      setSession(sess);\n      if (!(sess !== null && sess !== void 0 && (_sess$user = sess.user) !== null && _sess$user !== void 0 && _sess$user.id)) {\n        setRole(\"guest\");\n        return;\n      }\n      // refresh role\n      supabase.from(\"profiles\").select(\"role\").eq(\"user_id\", sess.user.id).single().then(({\n        data\n      }) => setRole((data === null || data === void 0 ? void 0 : data.role) || \"user\"));\n    });\n    return () => {\n      var _sub$subscription, _sub$subscription$uns;\n      mounted = false;\n      sub === null || sub === void 0 ? void 0 : (_sub$subscription = sub.subscription) === null || _sub$subscription === void 0 ? void 0 : (_sub$subscription$uns = _sub$subscription.unsubscribe) === null || _sub$subscription$uns === void 0 ? void 0 : _sub$subscription$uns.call(_sub$subscription);\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthCtx.Provider, {\n    value: {\n      session,\n      role,\n      loading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 5\n  }, this);\n}\n_s2(AuthProvider, \"LimCL8DzlsfF3+5SUOsZlMqJk3c=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","supabase","jsxDEV","_jsxDEV","AuthCtx","useAuth","_s","AuthProvider","children","_s2","session","setSession","role","setRole","loading","setLoading","mounted","load","_session$user","data","auth","getSession","user","id","prof","from","select","eq","single","sub","onAuthStateChange","_event","sess","_sess$user","then","_sub$subscription","_sub$subscription$uns","subscription","unsubscribe","call","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Projects/cidika-travel/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\nconst AuthCtx = createContext(null);\r\nexport const useAuth = () => useContext(AuthCtx);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [session, setSession] = useState(null);\r\n  const [role, setRole] = useState(\"guest\");\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    async function load() {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      if (!mounted) return;\r\n      setSession(session);\r\n\r\n      if (session?.user?.id) {\r\n        const { data: prof } = await supabase\r\n          .from(\"profiles\")\r\n          .select(\"role\")\r\n          .eq(\"user_id\", session.user.id)\r\n          .single();\r\n        setRole(prof?.role || \"user\");\r\n      } else {\r\n        setRole(\"guest\");\r\n      }\r\n      setLoading(false);\r\n    }\r\n\r\n    load();\r\n\r\n    const { data: sub } = supabase.auth.onAuthStateChange((_event, sess) => {\r\n      setSession(sess);\r\n      if (!sess?.user?.id) {\r\n        setRole(\"guest\");\r\n        return;\r\n      }\r\n      // refresh role\r\n      supabase.from(\"profiles\").select(\"role\").eq(\"user_id\", sess.user.id).single()\r\n        .then(({ data }) => setRole(data?.role || \"user\"));\r\n    });\r\n\r\n    return () => { mounted = false; sub?.subscription?.unsubscribe?.(); };\r\n  }, []);\r\n\r\n  return (\r\n    <AuthCtx.Provider value={{ session, role, loading }}>\r\n      {children}\r\n    </AuthCtx.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}