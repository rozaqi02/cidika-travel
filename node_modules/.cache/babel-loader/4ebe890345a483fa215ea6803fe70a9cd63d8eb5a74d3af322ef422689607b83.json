{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/usePackages.js\nimport { useEffect, useState, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { supabase } from \"../lib/supabaseClient.js\";\nexport default function usePackages({\n  live = true\n} = {}) {\n  _s();\n  const {\n    i18n\n  } = useTranslation();\n  const lang = (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0];\n  const [rows, setRows] = useState([]);\n  const [loading, setLoad] = useState(true);\n  const [error, setError] = useState(null);\n  const fetchData = async () => {\n    setLoad(true);\n    setError(null);\n    const {\n      data,\n      error\n    } = await supabase.from(\"packages\").select(`\n        id, slug, is_active, default_image,\n        price_tiers ( pax, price_idr, audience ),\n        package_locales ( lang, title, summary, spots, itinerary, include, note )\n      `).eq(\"is_active\", true).order(\"created_at\", {\n      ascending: true\n    });\n    if (error) {\n      setError(error);\n      setRows([]);\n      setLoad(false);\n      return;\n    }\n    const mapped = (data || []).map(p => {\n      var _p$package_locales, _p$package_locales2, _p$package_locales3;\n      const loc = ((_p$package_locales = p.package_locales) === null || _p$package_locales === void 0 ? void 0 : _p$package_locales.find(l => l.lang === lang)) || ((_p$package_locales2 = p.package_locales) === null || _p$package_locales2 === void 0 ? void 0 : _p$package_locales2.find(l => l.lang === \"en\")) || ((_p$package_locales3 = p.package_locales) === null || _p$package_locales3 === void 0 ? void 0 : _p$package_locales3[0]) || null;\n\n      // default audience: domestic\n      const tiers = (p.price_tiers || []).filter(t => (t.audience || \"domestic\") === \"domestic\");\n      return {\n        id: p.id,\n        slug: p.slug,\n        default_image: p.default_image,\n        locale: loc,\n        price_tiers: tiers\n      };\n    });\n    setRows(mapped);\n    setLoad(false);\n  };\n  useEffect(() => {\n    fetchData(); /* eslint-disable-next-line */\n  }, [lang]);\n  useEffect(() => {\n    if (!live) return;\n    const ch = supabase.channel(\"packages-live\").on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"packages\"\n    }, fetchData).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"price_tiers\"\n    }, fetchData).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"package_locales\"\n    }, fetchData).subscribe();\n    return () => supabase.removeChannel(ch);\n  }, [live]);\n  return {\n    rows,\n    loading,\n    error,\n    refetch: fetchData\n  };\n}\n_s(usePackages, \"y16zD3EZkdsx4780MNCMgBPB18s=\", false, function () {\n  return [useTranslation];\n});","map":{"version":3,"names":["useEffect","useState","useMemo","useTranslation","supabase","usePackages","live","_s","i18n","lang","resolvedLanguage","language","split","rows","setRows","loading","setLoad","error","setError","fetchData","data","from","select","eq","order","ascending","mapped","map","p","_p$package_locales","_p$package_locales2","_p$package_locales3","loc","package_locales","find","l","tiers","price_tiers","filter","t","audience","id","slug","default_image","locale","ch","channel","on","event","schema","table","subscribe","removeChannel","refetch"],"sources":["C:/Projects/cidika-travel/src/hooks/usePackages.js"],"sourcesContent":["// src/hooks/usePackages.js\r\nimport { useEffect, useState, useMemo } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\nexport default function usePackages({ live = true } = {}) {\r\n  const { i18n } = useTranslation();\r\n  const lang = (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0];\r\n\r\n  const [rows, setRows]     = useState([]);\r\n  const [loading, setLoad]  = useState(true);\r\n  const [error, setError]   = useState(null);\r\n\r\n  const fetchData = async () => {\r\n    setLoad(true);\r\n    setError(null);\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"packages\")\r\n      .select(`\r\n        id, slug, is_active, default_image,\r\n        price_tiers ( pax, price_idr, audience ),\r\n        package_locales ( lang, title, summary, spots, itinerary, include, note )\r\n      `)\r\n      .eq(\"is_active\", true)\r\n      .order(\"created_at\", { ascending: true });\r\n\r\n    if (error) {\r\n      setError(error);\r\n      setRows([]);\r\n      setLoad(false);\r\n      return;\r\n    }\r\n\r\n    const mapped = (data || []).map((p) => {\r\n      const loc =\r\n        p.package_locales?.find((l) => l.lang === lang) ||\r\n        p.package_locales?.find((l) => l.lang === \"en\") ||\r\n        p.package_locales?.[0] ||\r\n        null;\r\n\r\n      // default audience: domestic\r\n      const tiers = (p.price_tiers || []).filter((t) => (t.audience || \"domestic\") === \"domestic\");\r\n\r\n      return {\r\n        id: p.id,\r\n        slug: p.slug,\r\n        default_image: p.default_image,\r\n        locale: loc,\r\n        price_tiers: tiers,\r\n      };\r\n    });\r\n\r\n    setRows(mapped);\r\n    setLoad(false);\r\n  };\r\n\r\n  useEffect(() => { fetchData(); /* eslint-disable-next-line */ }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (!live) return;\r\n    const ch = supabase\r\n      .channel(\"packages-live\")\r\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"packages\" }, fetchData)\r\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"price_tiers\" }, fetchData)\r\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"package_locales\" }, fetchData)\r\n      .subscribe();\r\n    return () => supabase.removeChannel(ch);\r\n  }, [live]);\r\n\r\n  return { rows, loading, error, refetch: fetchData };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}