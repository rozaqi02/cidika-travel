{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projects\\\\cidika-travel\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabaseClient.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthCtx = /*#__PURE__*/createContext(null);\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthCtx);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const [session, setSession] = useState(null);\n  const [role, setRole] = useState(\"guest\"); // 'guest' | 'user' | 'admin'\n  const [loading, setLoading] = useState(true);\n  async function fetchRole(userId) {\n    if (!userId) {\n      setRole(\"guest\");\n      return;\n    }\n    const {\n      data,\n      error\n    } = await supabase.from(\"profiles\").select(\"role\").eq(\"user_id\", userId).single();\n    if (error) {\n      // fallback aman: kalau profil belum ada, anggap 'user'\n      setRole(\"user\");\n      return;\n    }\n    setRole((data === null || data === void 0 ? void 0 : data.role) || \"user\");\n  }\n  useEffect(() => {\n    let mounted = true;\n    (async _session$user => {\n      const {\n        data: {\n          session\n        }\n      } = await supabase.auth.getSession();\n      if (!mounted) return;\n      setSession(session);\n      await fetchRole(session === null || session === void 0 ? void 0 : (_session$user = session.user) === null || _session$user === void 0 ? void 0 : _session$user.id);\n      setLoading(false);\n    })();\n    const {\n      data: sub\n    } = supabase.auth.onAuthStateChange((_event, sess) => {\n      var _sess$user;\n      setSession(sess);\n      fetchRole(sess === null || sess === void 0 ? void 0 : (_sess$user = sess.user) === null || _sess$user === void 0 ? void 0 : _sess$user.id);\n    });\n    return () => {\n      var _sub$subscription, _sub$subscription$uns;\n      mounted = false;\n      sub === null || sub === void 0 ? void 0 : (_sub$subscription = sub.subscription) === null || _sub$subscription === void 0 ? void 0 : (_sub$subscription$uns = _sub$subscription.unsubscribe) === null || _sub$subscription$uns === void 0 ? void 0 : _sub$subscription$uns.call(_sub$subscription);\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthCtx.Provider, {\n    value: {\n      session,\n      role,\n      loading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 5\n  }, this);\n}\n_s2(AuthProvider, \"LimCL8DzlsfF3+5SUOsZlMqJk3c=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","supabase","jsxDEV","_jsxDEV","AuthCtx","useAuth","_s","AuthProvider","children","_s2","session","setSession","role","setRole","loading","setLoading","fetchRole","userId","data","error","from","select","eq","single","mounted","_session$user","auth","getSession","user","id","sub","onAuthStateChange","_event","sess","_sess$user","_sub$subscription","_sub$subscription$uns","subscription","unsubscribe","call","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Projects/cidika-travel/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\nconst AuthCtx = createContext(null);\r\nexport const useAuth = () => useContext(AuthCtx);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [session, setSession] = useState(null);\r\n  const [role, setRole] = useState(\"guest\"); // 'guest' | 'user' | 'admin'\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  async function fetchRole(userId) {\r\n    if (!userId) { setRole(\"guest\"); return; }\r\n    const { data, error } = await supabase\r\n      .from(\"profiles\")\r\n      .select(\"role\")\r\n      .eq(\"user_id\", userId)\r\n      .single();\r\n    if (error) {\r\n      // fallback aman: kalau profil belum ada, anggap 'user'\r\n      setRole(\"user\");\r\n      return;\r\n    }\r\n    setRole(data?.role || \"user\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    (async () => {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      if (!mounted) return;\r\n      setSession(session);\r\n      await fetchRole(session?.user?.id);\r\n      setLoading(false);\r\n    })();\r\n\r\n    const { data: sub } = supabase.auth.onAuthStateChange((_event, sess) => {\r\n      setSession(sess);\r\n      fetchRole(sess?.user?.id);\r\n    });\r\n\r\n    return () => { mounted = false; sub?.subscription?.unsubscribe?.(); };\r\n  }, []);\r\n\r\n  return (\r\n    <AuthCtx.Provider value={{ session, role, loading }}>\r\n      {children}\r\n    </AuthCtx.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}