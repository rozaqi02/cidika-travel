{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { supabase } from \"../lib/supabaseClient.js\";\n\n/**\r\n * Ambil paket aktif, dengan localized fields sesuai bahasa saat ini:\r\n * - packages (id, slug, default_image, is_active)\r\n * - price_tiers (pax, price_idr, audience)\r\n * - package_locales (lang=aktif) -> title, summary, spots, itinerary, include, note\r\n */\nexport default function usePackages() {\n  _s();\n  const {\n    i18n\n  } = useTranslation();\n  const lang = useMemo(() => (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0], [i18n.language, i18n.resolvedLanguage]);\n  const [rows, setRows] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [errorMsg, setError] = useState(\"\");\n  useEffect(() => {\n    let cancelled = false;\n    async function run() {\n      setLoading(true);\n      setError(\"\");\n\n      // Query nested select + filter is_active & lang\n      const {\n        data,\n        error\n      } = await supabase.from(\"packages\").select(`\n          id, slug, default_image, is_active,\n          price_tiers ( pax, price_idr, audience ),\n          package_locales!inner ( lang, title, summary, spots, itinerary, include, note )\n        `).eq(\"is_active\", true).eq(\"package_locales.lang\", lang).order(\"slug\", {\n        ascending: true\n      });\n      if (cancelled) return;\n      if (error) {\n        console.error(\"[usePackages] error:\", error);\n        setError(error.message || \"Failed to fetch\");\n        setRows([]);\n      } else {\n        // Map agar cocok ke UI (ambil locale yg udah difilter)\n        const mapped = (data || []).map(p => {\n          const loc = Array.isArray(p.package_locales) ? p.package_locales[0] : p.package_locales;\n          return {\n            id: p.id,\n            slug: p.slug,\n            default_image: p.default_image,\n            price_tiers: (p.price_tiers || []).sort((a, b) => a.pax - b.pax),\n            locale: {\n              title: (loc === null || loc === void 0 ? void 0 : loc.title) || \"\",\n              summary: (loc === null || loc === void 0 ? void 0 : loc.summary) || \"\",\n              spots: (loc === null || loc === void 0 ? void 0 : loc.spots) || [],\n              itinerary: (loc === null || loc === void 0 ? void 0 : loc.itinerary) || [],\n              include: (loc === null || loc === void 0 ? void 0 : loc.include) || [],\n              note: (loc === null || loc === void 0 ? void 0 : loc.note) || \"\"\n            }\n          };\n        });\n        setRows(mapped);\n      }\n      setLoading(false);\n    }\n    run();\n    return () => {\n      cancelled = true;\n    };\n  }, [lang]);\n  return {\n    rows,\n    loading,\n    error: errorMsg,\n    lang\n  };\n}\n_s(usePackages, \"CBfHDXEqjDkcB0j0RN+6BBqgM8s=\", false, function () {\n  return [useTranslation];\n});","map":{"version":3,"names":["useEffect","useMemo","useState","useTranslation","supabase","usePackages","_s","i18n","lang","resolvedLanguage","language","split","rows","setRows","loading","setLoading","errorMsg","setError","cancelled","run","data","error","from","select","eq","order","ascending","console","message","mapped","map","p","loc","Array","isArray","package_locales","id","slug","default_image","price_tiers","sort","a","b","pax","locale","title","summary","spots","itinerary","include","note"],"sources":["C:/Projects/cidika-travel/src/hooks/usePackages.js"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\n/**\r\n * Ambil paket aktif, dengan localized fields sesuai bahasa saat ini:\r\n * - packages (id, slug, default_image, is_active)\r\n * - price_tiers (pax, price_idr, audience)\r\n * - package_locales (lang=aktif) -> title, summary, spots, itinerary, include, note\r\n */\r\nexport default function usePackages() {\r\n  const { i18n } = useTranslation();\r\n  const lang = useMemo(() => (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0], [i18n.language, i18n.resolvedLanguage]);\r\n\r\n  const [rows, setRows] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [errorMsg, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    async function run() {\r\n      setLoading(true);\r\n      setError(\"\");\r\n\r\n      // Query nested select + filter is_active & lang\r\n      const { data, error } = await supabase\r\n        .from(\"packages\")\r\n        .select(`\r\n          id, slug, default_image, is_active,\r\n          price_tiers ( pax, price_idr, audience ),\r\n          package_locales!inner ( lang, title, summary, spots, itinerary, include, note )\r\n        `)\r\n        .eq(\"is_active\", true)\r\n        .eq(\"package_locales.lang\", lang)\r\n        .order(\"slug\", { ascending: true });\r\n\r\n      if (cancelled) return;\r\n\r\n      if (error) {\r\n        console.error(\"[usePackages] error:\", error);\r\n        setError(error.message || \"Failed to fetch\");\r\n        setRows([]);\r\n      } else {\r\n        // Map agar cocok ke UI (ambil locale yg udah difilter)\r\n        const mapped = (data || []).map((p) => {\r\n          const loc = Array.isArray(p.package_locales) ? p.package_locales[0] : p.package_locales;\r\n          return {\r\n            id: p.id,\r\n            slug: p.slug,\r\n            default_image: p.default_image,\r\n            price_tiers: (p.price_tiers || []).sort((a, b) => a.pax - b.pax),\r\n            locale: {\r\n              title: loc?.title || \"\",\r\n              summary: loc?.summary || \"\",\r\n              spots: loc?.spots || [],\r\n              itinerary: loc?.itinerary || [],\r\n              include: loc?.include || [],\r\n              note: loc?.note || \"\",\r\n            },\r\n          };\r\n        });\r\n        setRows(mapped);\r\n      }\r\n      setLoading(false);\r\n    }\r\n\r\n    run();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [lang]);\r\n\r\n  return { rows, loading, error: errorMsg, lang };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}