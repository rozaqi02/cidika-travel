{"ast":null,"code":"import _objectSpread from\"C:/Projects/cidika-travel/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/hooks/usePageSections.js\nimport{useEffect,useState}from\"react\";import{useTranslation}from\"react-i18next\";import{supabase}from\"../lib/supabaseClient.js\";/**\r\n * Ambil konten kustom per-halaman dari:\r\n * - page_sections\r\n * - page_section_locales (join semua bahasa)\r\n */export default function usePageSections(page){let{live=true}=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{i18n}=useTranslation();const lang=(i18n.resolvedLanguage||i18n.language||\"en\").split(\"-\")[0];const[sections,setSections]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const fetchData=async()=>{setLoading(true);setError(null);const{data,error}=await supabase.from(\"page_sections\").select(\"\\n        id, page, section_key, sort_index, data,\\n        page_section_locales (*)\\n      \").eq(\"page\",page).order(\"sort_index\",{ascending:true});if(error){setError(error);setSections([]);setLoading(false);return;}const mapped=(data||[]).map(s=>{var _s$page_section_local,_s$page_section_local2,_s$page_section_local3;const loc=((_s$page_section_local=s.page_section_locales)===null||_s$page_section_local===void 0?void 0:_s$page_section_local.find(l=>l.lang===lang))||((_s$page_section_local2=s.page_section_locales)===null||_s$page_section_local2===void 0?void 0:_s$page_section_local2.find(l=>l.lang===\"en\"))||((_s$page_section_local3=s.page_section_locales)===null||_s$page_section_local3===void 0?void 0:_s$page_section_local3[0])||null;return _objectSpread(_objectSpread({},s),{},{locale:loc});});setSections(mapped);setLoading(false);};useEffect(()=>{fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[page,lang]);useEffect(()=>{if(!live)return;const channel=supabase.channel(\"page_sections:\".concat(page)).on(\"postgres_changes\",{event:\"*\",schema:\"public\",table:\"page_sections\",filter:\"page=eq.\".concat(page)},fetchData).on(\"postgres_changes\",{event:\"*\",schema:\"public\",table:\"page_section_locales\"},fetchData).subscribe();return()=>{supabase.removeChannel(channel);};},[page,live]);return{sections,loading,error,refetch:fetchData};}","map":{"version":3,"names":["useEffect","useState","useTranslation","supabase","usePageSections","page","live","arguments","length","undefined","i18n","lang","resolvedLanguage","language","split","sections","setSections","loading","setLoading","error","setError","fetchData","data","from","select","eq","order","ascending","mapped","map","s","_s$page_section_local","_s$page_section_local2","_s$page_section_local3","loc","page_section_locales","find","l","_objectSpread","locale","channel","concat","on","event","schema","table","filter","subscribe","removeChannel","refetch"],"sources":["C:/Projects/cidika-travel/src/hooks/usePageSections.js"],"sourcesContent":["// src/hooks/usePageSections.js\r\nimport { useEffect, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\n\r\n/**\r\n * Ambil konten kustom per-halaman dari:\r\n * - page_sections\r\n * - page_section_locales (join semua bahasa)\r\n */\r\nexport default function usePageSections(page, { live = true } = {}) {\r\n  const { i18n } = useTranslation();\r\n  const lang = (i18n.resolvedLanguage || i18n.language || \"en\").split(\"-\")[0];\r\n\r\n  const [sections, setSections] = useState([]);\r\n  const [loading, setLoading]   = useState(true);\r\n  const [error, setError]       = useState(null);\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"page_sections\")\r\n      .select(`\r\n        id, page, section_key, sort_index, data,\r\n        page_section_locales (*)\r\n      `)\r\n      .eq(\"page\", page)\r\n      .order(\"sort_index\", { ascending: true });\r\n\r\n    if (error) {\r\n      setError(error);\r\n      setSections([]);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const mapped = (data || []).map((s) => {\r\n      const loc =\r\n        s.page_section_locales?.find((l) => l.lang === lang) ||\r\n        s.page_section_locales?.find((l) => l.lang === \"en\") ||\r\n        s.page_section_locales?.[0] ||\r\n        null;\r\n      return { ...s, locale: loc };\r\n    });\r\n\r\n    setSections(mapped);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [page, lang]);\r\n\r\n  useEffect(() => {\r\n    if (!live) return;\r\n\r\n    const channel = supabase\r\n      .channel(`page_sections:${page}`)\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"page_sections\", filter: `page=eq.${page}` },\r\n        fetchData\r\n      )\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"page_section_locales\" },\r\n        fetchData\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [page, live]);\r\n\r\n  return { sections, loading, error, refetch: fetchData };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}