{"ast":null,"code":"import _objectSpread from\"C:/Projects/cidika-travel/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from\"react\";import{useCart}from\"../context/CartContext\";import{supabase}from\"../lib/supabaseClient.js\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Checkout(){const{items,clear}=useCart();const nav=useNavigate();const[form,setForm]=useState({name:\"\",email:\"\",phone:\"\",date:\"\",notes:\"\"});const[loading,setLoading]=useState(false);const[msg,setMsg]=useState(\"\");const onSubmit=async e=>{e.preventDefault();if(!items.length){setMsg(\"Keranjang kosong.\");return;}const first=items[0];// satu paket per order, pakai package_id dari item pertama\nsetLoading(true);setMsg(\"Membuat order...\");try{var _data$;const payload={p_package_id:first.id,// HARUS uuid packages.id\np_date:form.date||new Date().toISOString().slice(0,10),p_pax:first.pax||1,p_audience:\"domestic\",p_customer_name:form.name,p_email:form.email,p_phone:form.phone,p_notes:form.notes||\"\",p_items:items.map(it=>({item_name:it.title,qty:it.qty||1,price_idr:it.price||0}))};const{data,error}=await supabase.rpc(\"place_order\",payload);if(error)throw error;clear();setMsg(\"Order dibuat! Kode publik: \"+(data===null||data===void 0?void 0:(_data$=data[0])===null||_data$===void 0?void 0:_data$.public_code));nav(\"/\");// sementara arahkan pulang; nanti ganti ke halaman \"Terima kasih\" + instruksi bayar\n}catch(e2){setMsg(e2.message||\"Gagal membuat order\");}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-6 grid md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card p-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold mb-2\",children:\"Checkout\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"grid gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"border rounded-xl px-3 py-2 dark:bg-slate-900\",placeholder:\"Nama Lengkap\",value:form.name,onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{name:e.target.value})),required:true}),/*#__PURE__*/_jsx(\"input\",{className:\"border rounded-xl px-3 py-2 dark:bg-slate-900\",placeholder:\"Email\",type:\"email\",value:form.email,onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{email:e.target.value})),required:true}),/*#__PURE__*/_jsx(\"input\",{className:\"border rounded-xl px-3 py-2 dark:bg-slate-900\",placeholder:\"Telepon/WA\",value:form.phone,onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{phone:e.target.value}))}),/*#__PURE__*/_jsx(\"input\",{className:\"border rounded-xl px-3 py-2 dark:bg-slate-900\",placeholder:\"Tanggal Trip (YYYY-MM-DD)\",value:form.date,onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{date:e.target.value}))}),/*#__PURE__*/_jsx(\"textarea\",{className:\"border rounded-xl px-3 py-2 dark:bg-slate-900\",placeholder:\"Catatan\",rows:\"4\",value:form.notes,onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{notes:e.target.value}))}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",disabled:loading,children:loading?\"Memproses...\":\"Buat Pesanan\"}),msg&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-500\",children:msg})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card p-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"font-semibold mb-2\",children:\"Ringkasan\"}),items.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"Keranjang kosong\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-2\",children:items.map(it=>/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[it.title,\" \\xD7 \",it.qty]}),/*#__PURE__*/_jsx(\"span\",{children:(it.price||0).toLocaleString(\"id-ID\")})]},it.id))})]})]});}","map":{"version":3,"names":["React","useState","useCart","supabase","useNavigate","jsx","_jsx","jsxs","_jsxs","Checkout","items","clear","nav","form","setForm","name","email","phone","date","notes","loading","setLoading","msg","setMsg","onSubmit","e","preventDefault","length","first","_data$","payload","p_package_id","id","p_date","Date","toISOString","slice","p_pax","pax","p_audience","p_customer_name","p_email","p_phone","p_notes","p_items","map","it","item_name","title","qty","price_idr","price","data","error","rpc","public_code","e2","message","className","children","placeholder","value","onChange","_objectSpread","target","required","type","rows","disabled","toLocaleString"],"sources":["C:/Projects/cidika-travel/src/pages/Checkout.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { useCart } from \"../context/CartContext\";\r\nimport { supabase } from \"../lib/supabaseClient.js\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nexport default function Checkout() {\r\n  const { items, clear } = useCart();\r\n  const nav = useNavigate();\r\n  const [form, setForm] = useState({ name:\"\", email:\"\", phone:\"\", date:\"\", notes:\"\" });\r\n  const [loading, setLoading] = useState(false);\r\n  const [msg, setMsg] = useState(\"\");\r\n\r\n  const onSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!items.length) { setMsg(\"Keranjang kosong.\"); return; }\r\n    const first = items[0]; // satu paket per order, pakai package_id dari item pertama\r\n    setLoading(true);\r\n    setMsg(\"Membuat order...\");\r\n    try {\r\n      const payload = {\r\n        p_package_id: first.id,              // HARUS uuid packages.id\r\n        p_date: form.date || new Date().toISOString().slice(0,10),\r\n        p_pax: first.pax || 1,\r\n        p_audience: \"domestic\",\r\n        p_customer_name: form.name,\r\n        p_email: form.email,\r\n        p_phone: form.phone,\r\n        p_notes: form.notes || \"\",\r\n        p_items: items.map(it => ({ item_name: it.title, qty: it.qty || 1, price_idr: it.price || 0 }))\r\n      };\r\n      const { data, error } = await supabase.rpc(\"place_order\", payload);\r\n      if (error) throw error;\r\n      clear();\r\n      setMsg(\"Order dibuat! Kode publik: \" + data?.[0]?.public_code);\r\n      nav(\"/\"); // sementara arahkan pulang; nanti ganti ke halaman \"Terima kasih\" + instruksi bayar\r\n    } catch (e2) {\r\n      setMsg(e2.message || \"Gagal membuat order\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mt-6 grid md:grid-cols-2 gap-6\">\r\n      <div className=\"card p-4\">\r\n        <h1 className=\"text-2xl font-bold mb-2\">Checkout</h1>\r\n        <form onSubmit={onSubmit} className=\"grid gap-3\">\r\n          <input className=\"border rounded-xl px-3 py-2 dark:bg-slate-900\" placeholder=\"Nama Lengkap\" value={form.name} onChange={e=>setForm({...form, name:e.target.value})} required />\r\n          <input className=\"border rounded-xl px-3 py-2 dark:bg-slate-900\" placeholder=\"Email\" type=\"email\" value={form.email} onChange={e=>setForm({...form, email:e.target.value})} required />\r\n          <input className=\"border rounded-xl px-3 py-2 dark:bg-slate-900\" placeholder=\"Telepon/WA\" value={form.phone} onChange={e=>setForm({...form, phone:e.target.value})} />\r\n          <input className=\"border rounded-xl px-3 py-2 dark:bg-slate-900\" placeholder=\"Tanggal Trip (YYYY-MM-DD)\" value={form.date} onChange={e=>setForm({...form, date:e.target.value})} />\r\n          <textarea className=\"border rounded-xl px-3 py-2 dark:bg-slate-900\" placeholder=\"Catatan\" rows=\"4\" value={form.notes} onChange={e=>setForm({...form, notes:e.target.value})} />\r\n          <button className=\"btn btn-primary\" disabled={loading}>{loading ? \"Memproses...\" : \"Buat Pesanan\"}</button>\r\n          {msg && <p className=\"text-sm text-slate-500\">{msg}</p>}\r\n        </form>\r\n      </div>\r\n      <div className=\"card p-4\">\r\n        <h2 className=\"font-semibold mb-2\">Ringkasan</h2>\r\n        {items.length === 0 ? <p className=\"text-slate-500\">Keranjang kosong</p> :\r\n          <ul className=\"space-y-2\">\r\n            {items.map(it => (\r\n              <li key={it.id} className=\"flex items-center justify-between\">\r\n                <span>{it.title} Ã— {it.qty}</span>\r\n                <span>{(it.price||0).toLocaleString(\"id-ID\")}</span>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}